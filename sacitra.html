<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Dapodik - SMK Negeri 1 Cikarang Utara</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        .menu-card {
            transition: all 0.3s ease;
        }
        
        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .icon-container {
            transition: all 0.3s ease;
        }
        
        .menu-card:hover .icon-container {
            transform: scale(1.1);
        }
        
        .data-table {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-screen" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
  <div id="app" class="w-full min-h-screen"><!-- Header -->
   <header class="bg-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
     <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
      <div class="flex items-center gap-3 sm:gap-4"><img src="https://www.smkn1cikarangutara.sch.id/upload/imagecache/28025611logosekolah-600x600.png" alt="Logo SMK Negeri 1 Cikarang Utara" width="60" height="60" class="flex-shrink-0 rounded-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
       <svg width="60" height="60" viewbox="0 0 60 60" class="flex-shrink-0" style="display: none;"><rect width="60" height="60" rx="12" fill="#667eea" /> <path d="M30 15L18 25V45H26V35H34V45H42V25L30 15Z" fill="white" /> <circle cx="30" cy="28" r="2" fill="#667eea" />
       </svg>
       <div>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Dashboard Dapodik</h1>
        <p class="text-sm text-gray-600 mt-1">SMK Negeri 1 Cikarang Utara</p>
       </div>
      </div>
      <div class="flex flex-wrap items-center gap-2"><button id="btn-refresh" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 text-sm sm:px-4 rounded-lg font-medium transition-colors"> üîÑ <span class="hidden sm:inline">Refresh</span> </button> <select id="column-dropdown" class="bg-white border border-gray-300 text-gray-700 px-3 py-2 text-sm rounded-lg font-medium focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="3">3 Kolom</option> <option value="5">5 Kolom</option> <option value="7">7 Kolom</option> <option value="10">10 Kolom</option> <option value="15">15 Kolom</option> </select> <button id="btn-manage-menu" class="hidden bg-green-600 hover:bg-green-700 text-white px-3 py-2 text-sm sm:px-4 rounded-lg font-medium transition-colors"> ‚ûï <span class="hidden sm:inline">Kelola Menu</span> </button> <button id="btn-admin-login" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 text-sm sm:px-4 rounded-lg font-medium transition-colors"> üëë <span class="hidden sm:inline">Admin</span> </button>
       <div id="user-info" class="hidden flex items-center gap-2"><span id="role-badge" class="text-xs px-3 py-1 rounded-full font-medium bg-purple-100 text-purple-700">üëë Admin</span> <button id="btn-logout" class="text-sm text-red-600 hover:text-red-700 font-medium"> Logout </button>
       </div>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Menu Grid -->
    <div id="menu-section" class="grid gap-4 mb-8"><!-- Menu Cards will be generated here -->
    </div><!-- Sub Menu Section -->
    <div id="submenu-section" class="hidden">
     <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-6">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6">
       <div class="flex items-center space-x-3 sm:space-x-4"><span id="submenu-icon" class="text-4xl sm:text-5xl"></span>
        <div>
         <h2 id="submenu-title" class="text-xl sm:text-2xl font-bold text-gray-900"></h2>
         <p class="text-xs sm:text-sm text-gray-600">Pilih sub menu untuk melihat data</p>
        </div>
       </div>
       <div class="flex flex-wrap gap-2 w-full sm:w-auto"><button id="btn-manage-submenu" class="hidden bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 text-sm sm:px-4 rounded-lg font-medium transition-colors flex-1 sm:flex-initial"> ‚öôÔ∏è <span class="hidden sm:inline">Kelola</span> Sub Menu </button> <button id="btn-back-main" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 text-sm sm:px-4 rounded-lg font-medium transition-colors flex-1 sm:flex-initial"> ‚Üê Kembali </button>
       </div>
      </div>
      <div id="submenu-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4"><!-- Sub menu cards will be generated here -->
      </div>
     </div>
    </div><!-- Data Display Section -->
    <div id="data-section" class="hidden">
     <div class="bg-white rounded-lg shadow-lg p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6">
       <h2 id="data-title" class="text-xl sm:text-2xl font-bold text-gray-900"></h2><button id="btn-back" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 text-sm sm:text-base rounded-lg font-medium transition-colors w-full sm:w-auto"> ‚Üê Kembali </button>
      </div><!-- Loading State -->
      <div id="loading-state" class="flex flex-col items-center justify-center py-12">
       <div class="loading-spinner"></div>
       <p class="text-gray-600 mt-4 text-sm sm:text-base">Memuat data...</p>
      </div><!-- Error State -->
      <div id="error-state" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 sm:p-6 text-center">
       <p class="text-red-600 font-medium mb-2 text-sm sm:text-base">‚ö†Ô∏è Gagal memuat data</p>
       <p id="error-message" class="text-red-500 text-xs sm:text-sm mb-4"></p><button id="btn-retry" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors text-sm sm:text-base"> Coba Lagi </button>
      </div><!-- Data Table -->
      <div id="table-container" class="hidden overflow-x-auto -mx-4 sm:mx-0">
       <div class="inline-block min-w-full align-middle">
        <table class="min-w-full divide-y divide-gray-200">
         <thead class="bg-gray-50">
          <tr id="table-header"></tr>
         </thead>
         <tbody id="table-body" class="bg-white divide-y divide-gray-200"></tbody>
        </table>
       </div>
       <div id="pagination" class="mt-6 flex flex-col sm:flex-row items-center justify-between gap-3 px-4 sm:px-0">
        <p id="pagination-info" class="text-xs sm:text-sm text-gray-600"></p>
        <div class="flex gap-2 w-full sm:w-auto"><button id="btn-prev" class="flex-1 sm:flex-initial bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"> ‚Üê <span class="hidden sm:inline">Sebelumnya</span> </button> <button id="btn-next" class="flex-1 sm:flex-initial bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 sm:px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"> <span class="hidden sm:inline">Berikutnya</span> ‚Üí </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </main><!-- Footer -->
   <footer class="bg-white mt-12 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
     <p class="text-center text-gray-600 text-sm">¬© 2024 Dashboard Dapodik - SMK Negeri 1 Cikarang Utara</p>
    </div>
   </footer><!-- Manage Menu Modal -->
   <div id="manage-menu-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full mx-4 max-h-[90%] overflow-y-auto">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-gray-900">Kelola Menu</h3><button id="btn-add-menu" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> ‚ûï Tambah Menu Baru </button>
     </div>
     <div id="menu-list" class="space-y-3 mb-6"></div>
     <div class="flex justify-end"><button id="btn-close-manage" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors"> Tutup </button>
     </div>
    </div>
   </div><!-- Add/Edit Menu Modal -->
   <div id="add-menu-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full mx-4">
     <h3 id="menu-form-title" class="text-xl font-bold text-gray-900 mb-4">Tambah Menu Baru</h3>
     <form id="menu-form" class="space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Judul Menu *</label> <input type="text" id="input-menu-title" required placeholder="Contoh: Data Perpustakaan" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Icon Emoji *</label> <input type="text" id="input-menu-icon" required placeholder="Contoh: üìö" maxlength="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi *</label> <textarea id="input-menu-description" required placeholder="Contoh: Data buku dan peminjaman perpustakaan" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
      </div>
      <div class="flex justify-end space-x-3 pt-2"><button type="button" id="btn-cancel-menu" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors"> Batal </button> <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> Simpan </button>
      </div>
     </form>
    </div>
   </div><!-- Manage Sub Menu Modal -->
   <div id="manage-submenu-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full mx-4 max-h-[90%] overflow-y-auto">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-gray-900">Kelola Sub Menu</h3><button id="btn-add-submenu" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> ‚ûï Tambah Sub Menu </button>
     </div>
     <div id="submenu-list" class="space-y-3 mb-6"></div>
     <div class="flex justify-end"><button id="btn-close-submenu-manage" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors"> Tutup </button>
     </div>
    </div>
   </div><!-- Add/Edit Sub Menu Modal -->
   <div id="add-submenu-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full mx-4">
     <h3 id="submenu-form-title" class="text-xl font-bold text-gray-900 mb-4">Tambah Sub Menu</h3>
     <form id="submenu-form" class="space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Judul Sub Menu *</label> <input type="text" id="input-submenu-title" required placeholder="Contoh: Data Peminjaman" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Nama Sheet *</label> <input type="text" id="input-submenu-sheet" required placeholder="Contoh: Perpustakaan_Peminjaman" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
       <p class="text-xs text-gray-500 mt-1">Nama sheet harus SAMA PERSIS dengan nama di Google Sheets (huruf besar/kecil, spasi, underscore)</p>
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets URL *</label> <input type="text" id="input-submenu-url" required placeholder="https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
       <p class="text-xs text-gray-500 mt-1">Paste URL lengkap Google Sheets yang sudah dibagikan ke publik</p>
      </div>
      <div class="bg-yellow-50 border border-yellow-200 rounded p-3">
       <p class="text-xs text-yellow-800"><strong>‚ö†Ô∏è Penting:</strong> Google Sheets harus dibagikan sebagai "Anyone with the link can view"</p>
      </div>
      <div class="flex justify-end space-x-3 pt-2"><button type="button" id="btn-cancel-submenu" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors"> Batal </button> <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors"> Simpan </button>
      </div>
     </form>
    </div>
   </div><!-- Login Modal -->
   <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 sm:p-8 max-w-md w-full">
     <h3 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6 text-center">üëë Login Admin</h3>
     <form id="login-form" class="space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Username *</label> <input type="text" id="input-username" required placeholder="Masukkan username" class="w-full px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-2">Password *</label>
       <div class="relative"><input type="password" id="input-password" required placeholder="Masukkan password" class="w-full px-4 py-2 pr-12 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <button type="button" id="btn-toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors"> <span id="eye-icon">üëÅÔ∏è</span> </button>
       </div>
      </div>
      <div id="login-error" class="hidden bg-red-50 border border-red-200 text-red-600 px-4 py-2 rounded-lg text-sm"></div>
      <div class="flex flex-col sm:flex-row gap-2 pt-2"><button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base"> Login Admin </button> <button type="button" id="btn-cancel-login" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg font-medium transition-colors text-sm sm:text-base"> Batal </button>
      </div>
     </form>
    </div>
   </div>
  </div>
  <script>
        const adminCredentials = {
            username: 'administrator',
            password: 'admin20247250'
        };

        let currentUser = null;

        function checkAuth() {
            const savedUser = localStorage.getItem('dapodik_current_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                } catch (e) {
                    currentUser = null;
                }
            }
            updateUIForRole();
        }

        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function updateUIForRole() {
            const userInfo = document.getElementById('user-info');
            const manageMenuBtn = document.getElementById('btn-manage-menu');
            const adminBtn = document.getElementById('btn-admin-login');
            
            if (currentUser && currentUser.role === 'admin') {
                userInfo.classList.remove('hidden');
                manageMenuBtn.classList.remove('hidden');
                adminBtn.classList.add('hidden');
            } else {
                userInfo.classList.add('hidden');
                manageMenuBtn.classList.add('hidden');
                adminBtn.classList.remove('hidden');
            }
            
            const manageSubMenuBtn = document.getElementById('btn-manage-submenu');
            if (manageSubMenuBtn) {
                if (currentUser && currentUser.role === 'admin') {
                    manageSubMenuBtn.classList.remove('hidden');
                } else {
                    manageSubMenuBtn.classList.add('hidden');
                }
            }
        }

        let menuItems = [
            { 
                id: 'peserta_didik', 
                title: 'Peserta Didik', 
                icon: 'üë®‚Äçüéì', 
                description: 'Data siswa dan informasi peserta didik',
                subMenus: [
                    { id: 'pd_identitas', title: 'Identitas Peserta Didik', sheet: 'PD_Identitas', sheetUrl: '' },
                    { id: 'pd_registrasi', title: 'Registrasi Peserta Didik', sheet: 'PD_Registrasi', sheetUrl: '' },
                    { id: 'pd_periodik', title: 'Data Periodik', sheet: 'PD_Periodik', sheetUrl: '' },
                    { id: 'pd_kesehatan', title: 'Kesehatan', sheet: 'PD_Kesehatan', sheetUrl: '' },
                    { id: 'pd_beasiswa', title: 'Beasiswa', sheet: 'PD_Beasiswa', sheetUrl: '' }
                ]
            },
            { 
                id: 'ptk', 
                title: 'PTK', 
                icon: 'üë®‚Äçüè´', 
                description: 'Data Pendidik dan Tenaga Kependidikan',
                subMenus: [
                    { id: 'ptk_identitas', title: 'Identitas PTK', sheet: 'PTK_Identitas', sheetUrl: '' },
                    { id: 'ptk_tugas', title: 'Penugasan', sheet: 'PTK_Tugas', sheetUrl: '' },
                    { id: 'ptk_sertifikasi', title: 'Sertifikasi', sheet: 'PTK_Sertifikasi', sheetUrl: '' },
                    { id: 'ptk_inpassing', title: 'Inpassing', sheet: 'PTK_Inpassing', sheetUrl: '' },
                    { id: 'ptk_tunjangan', title: 'Tunjangan', sheet: 'PTK_Tunjangan', sheetUrl: '' }
                ]
            },
            { 
                id: 'sekolah', 
                title: 'Data Sekolah', 
                icon: 'üè´', 
                description: 'Informasi profil dan identitas sekolah',
                subMenus: [
                    { id: 'sekolah_identitas', title: 'Identitas Sekolah', sheet: 'Sekolah_Identitas', sheetUrl: '' },
                    { id: 'sekolah_kontak', title: 'Kontak Sekolah', sheet: 'Sekolah_Kontak', sheetUrl: '' },
                    { id: 'sekolah_rekening', title: 'Rekening', sheet: 'Sekolah_Rekening', sheetUrl: '' },
                    { id: 'sekolah_sanitasi', title: 'Sanitasi', sheet: 'Sekolah_Sanitasi', sheetUrl: '' }
                ]
            },
            { 
                id: 'rombel', 
                title: 'Rombongan Belajar', 
                icon: 'üìö', 
                description: 'Data kelas dan rombongan belajar',
                subMenus: [
                    { id: 'rombel_data', title: 'Data Rombongan Belajar', sheet: 'Rombel_Data', sheetUrl: '' },
                    { id: 'rombel_anggota', title: 'Anggota Rombel', sheet: 'Rombel_Anggota', sheetUrl: '' },
                    { id: 'rombel_pembelajaran', title: 'Pembelajaran', sheet: 'Rombel_Pembelajaran', sheetUrl: '' }
                ]
            },
            { 
                id: 'sarpras', 
                title: 'Sarana Prasarana', 
                icon: 'üèóÔ∏è', 
                description: 'Data sarana dan prasarana sekolah',
                subMenus: [
                    { id: 'sarpras_tanah', title: 'Tanah', sheet: 'Sarpras_Tanah', sheetUrl: '' },
                    { id: 'sarpras_bangunan', title: 'Bangunan', sheet: 'Sarpras_Bangunan', sheetUrl: '' },
                    { id: 'sarpras_ruang', title: 'Ruang', sheet: 'Sarpras_Ruang', sheetUrl: '' },
                    { id: 'sarpras_alat', title: 'Alat', sheet: 'Sarpras_Alat', sheetUrl: '' },
                    { id: 'sarpras_buku', title: 'Buku', sheet: 'Sarpras_Buku', sheetUrl: '' }
                ]
            },
            { 
                id: 'kurikulum', 
                title: 'Kurikulum', 
                icon: 'üìñ', 
                description: 'Data kurikulum dan mata pelajaran',
                subMenus: [
                    { id: 'kurikulum_struktur', title: 'Struktur Kurikulum', sheet: 'Kurikulum_Struktur', sheetUrl: '' },
                    { id: 'kurikulum_mapel', title: 'Mata Pelajaran', sheet: 'Kurikulum_Mapel', sheetUrl: '' },
                    { id: 'kurikulum_kompetensi', title: 'Kompetensi Keahlian', sheet: 'Kurikulum_Kompetensi', sheetUrl: '' }
                ]
            },
            { 
                id: 'nilai', 
                title: 'Nilai', 
                icon: 'üìä', 
                description: 'Data nilai dan penilaian siswa',
                subMenus: [
                    { id: 'nilai_rapor', title: 'Nilai Rapor', sheet: 'Nilai_Rapor', sheetUrl: '' },
                    { id: 'nilai_pts', title: 'Nilai PTS', sheet: 'Nilai_PTS', sheetUrl: '' },
                    { id: 'nilai_pas', title: 'Nilai PAS', sheet: 'Nilai_PAS', sheetUrl: '' },
                    { id: 'nilai_pkl', title: 'Nilai PKL', sheet: 'Nilai_PKL', sheetUrl: '' }
                ]
            },
            { 
                id: 'kehadiran', 
                title: 'Kehadiran', 
                icon: 'üìÖ', 
                description: 'Data kehadiran siswa dan PTK',
                subMenus: [
                    { id: 'kehadiran_siswa', title: 'Kehadiran Siswa', sheet: 'Kehadiran_Siswa', sheetUrl: '' },
                    { id: 'kehadiran_ptk', title: 'Kehadiran PTK', sheet: 'Kehadiran_PTK', sheetUrl: '' }
                ]
            },
            { 
                id: 'alumni', 
                title: 'Alumni', 
                icon: 'üéì', 
                description: 'Data lulusan dan alumni',
                subMenus: [
                    { id: 'alumni_data', title: 'Data Alumni', sheet: 'Alumni_Data', sheetUrl: '' },
                    { id: 'alumni_penelusuran', title: 'Penelusuran Alumni', sheet: 'Alumni_Penelusuran', sheetUrl: '' }
                ]
            }
        ];

        const loadMenusFromStorage = () => {
            const savedMenus = localStorage.getItem('dapodik_custom_menus');
            if (savedMenus) {
                try {
                    menuItems = JSON.parse(savedMenus);
                } catch (e) {
                    console.error('Error loading menus:', e);
                }
            }
        };

        const saveMenusToStorage = () => {
            localStorage.setItem('dapodik_custom_menus', JSON.stringify(menuItems));
        };

        let editingMenuId = null;
        let editingSubMenuId = null;
        let currentSheet = null;
        let currentSheetUrl = null;
        let currentData = [];
        let currentPage = 1;
        let itemsPerPage = 10;
        let gridColumns = localStorage.getItem('dapodik_grid_columns') || (window.innerWidth < 640 ? '3' : '5');

        function extractSheetId(url) {
            const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
            return match ? match[1] : null;
        }

        function init() {
            checkAuth();
            loadMenusFromStorage();
            renderMenuCards();
            setupEventListeners();
        }

        function updateGridColumns() {
            const menuSection = document.getElementById('menu-section');
            menuSection.className = `grid grid-cols-${gridColumns} gap-4 mb-8`;
            
            const dropdown = document.getElementById('column-dropdown');
            if (dropdown) {
                dropdown.value = gridColumns;
            }
        }

        function renderMenuCards() {
            const menuSection = document.getElementById('menu-section');
            menuSection.innerHTML = menuItems.map(item => `
                <div class="menu-card bg-white rounded-lg shadow-lg p-6 cursor-pointer" data-menu-id="${item.id}">
                    <div class="icon-container text-5xl mb-4">${item.icon}</div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${item.title}</h3>
                    <p class="text-gray-600 text-sm mb-3">${item.description}</p>
                    <div class="text-xs text-blue-600 font-medium">${item.subMenus ? item.subMenus.length : 0} sub menu</div>
                </div>
            `).join('');

            document.querySelectorAll('.menu-card').forEach(card => {
                card.addEventListener('click', () => {
                    const menuId = card.dataset.menuId;
                    showSubMenus(menuId);
                });
            });
            
            updateGridColumns();
        }

        function setupEventListeners() {
            document.getElementById('btn-admin-login').addEventListener('click', () => {
                showLoginModal();
            });

            document.getElementById('btn-cancel-login').addEventListener('click', () => {
                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('login-form').reset();
                document.getElementById('login-error').classList.add('hidden');
            });

            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('input-username').value.trim();
                const password = document.getElementById('input-password').value.trim();
                
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    currentUser = { username: username, role: 'admin' };
                    localStorage.setItem('dapodik_current_user', JSON.stringify(currentUser));
                    document.getElementById('login-modal').classList.add('hidden');
                    document.getElementById('login-error').classList.add('hidden');
                    document.getElementById('login-form').reset();
                    updateUIForRole();
                    showToast('‚úÖ Selamat datang, Admin!', 'success');
                } else {
                    document.getElementById('login-error').textContent = '‚ùå Username atau password salah';
                    document.getElementById('login-error').classList.remove('hidden');
                }
            });

            document.getElementById('btn-logout').addEventListener('click', () => {
                currentUser = null;
                localStorage.removeItem('dapodik_current_user');
                updateUIForRole();
                document.getElementById('login-form').reset();
                document.getElementById('login-error').classList.add('hidden');
                showToast('üëã Berhasil logout', 'info');
            });

            document.getElementById('btn-refresh').addEventListener('click', () => {
                if (currentSheet && currentSheetUrl) {
                    loadSheetData(currentSheet, currentSheetUrl);
                } else {
                    showToast('‚ÑπÔ∏è Pilih menu terlebih dahulu', 'info');
                }
            });

            document.getElementById('btn-manage-menu').addEventListener('click', () => {
                if (currentUser && currentUser.role === 'admin') {
                    renderMenuList();
                    document.getElementById('manage-menu-modal').classList.remove('hidden');
                }
            });

            document.getElementById('btn-manage-submenu').addEventListener('click', () => {
                if (currentUser && currentUser.role === 'admin' && currentMenuId) {
                    renderSubMenuList(currentMenuId);
                    document.getElementById('manage-submenu-modal').classList.remove('hidden');
                }
            });

            document.getElementById('column-dropdown').addEventListener('change', (e) => {
                gridColumns = e.target.value;
                localStorage.setItem('dapodik_grid_columns', gridColumns);
                updateGridColumns();
                showToast(`‚úÖ Tampilan diubah ke ${gridColumns} kolom`, 'success');
            });

            document.getElementById('btn-close-manage').addEventListener('click', () => {
                document.getElementById('manage-menu-modal').classList.add('hidden');
            });

            document.getElementById('btn-add-menu').addEventListener('click', () => {
                if (currentUser && currentUser.role === 'admin') {
                    openMenuForm();
                }
            });

            document.getElementById('btn-cancel-menu').addEventListener('click', () => {
                document.getElementById('add-menu-modal').classList.add('hidden');
            });

            document.getElementById('menu-form').addEventListener('submit', (e) => {
                e.preventDefault();
                if (currentUser && currentUser.role === 'admin') {
                    saveMenu();
                }
            });

            document.getElementById('btn-close-submenu-manage').addEventListener('click', () => {
                document.getElementById('manage-submenu-modal').classList.add('hidden');
            });

            document.getElementById('btn-add-submenu').addEventListener('click', () => {
                if (currentUser && currentUser.role === 'admin') {
                    openSubMenuForm();
                }
            });

            document.getElementById('btn-cancel-submenu').addEventListener('click', () => {
                document.getElementById('add-submenu-modal').classList.add('hidden');
            });

            document.getElementById('submenu-form').addEventListener('submit', (e) => {
                e.preventDefault();
                if (currentUser && currentUser.role === 'admin') {
                    saveSubMenu();
                }
            });

            document.getElementById('btn-back').addEventListener('click', () => {
                backToSubMenus();
            });

            document.getElementById('btn-back-main').addEventListener('click', () => {
                showMenuSection();
            });

            document.getElementById('btn-retry').addEventListener('click', () => {
                if (currentSheet && currentSheetUrl) {
                    loadSheetData(currentSheet, currentSheetUrl);
                }
            });

            document.getElementById('btn-prev').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                }
            });

            document.getElementById('btn-next').addEventListener('click', () => {
                const totalPages = Math.ceil(currentData.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                }
            });

            document.getElementById('btn-toggle-password').addEventListener('click', () => {
                const passwordInput = document.getElementById('input-password');
                const eyeIcon = document.getElementById('eye-icon');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    eyeIcon.textContent = 'üôà';
                } else {
                    passwordInput.type = 'password';
                    eyeIcon.textContent = 'üëÅÔ∏è';
                }
            });
        }

        function renderMenuList() {
            const menuList = document.getElementById('menu-list');
            menuList.innerHTML = menuItems.map((item, index) => `
                <div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between hover:bg-gray-100 transition-colors">
                    <div class="flex items-center space-x-4">
                        <span class="text-3xl">${item.icon}</span>
                        <div>
                            <h4 class="font-semibold text-gray-900">${item.title}</h4>
                            <p class="text-sm text-gray-600">${item.description}</p>
                            <p class="text-xs text-gray-500 mt-1">${item.subMenus ? item.subMenus.length : 0} sub menu</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="btn-edit-menu bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors" data-id="${item.id}">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn-delete-menu bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors" data-id="${item.id}">
                            üóëÔ∏è Hapus
                        </button>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.btn-edit-menu').forEach(btn => {
                btn.addEventListener('click', () => {
                    const menuId = btn.dataset.id;
                    openMenuForm(menuId);
                });
            });

            document.querySelectorAll('.btn-delete-menu').forEach(btn => {
                btn.addEventListener('click', () => {
                    const menuId = btn.dataset.id;
                    deleteMenu(menuId);
                });
            });
        }

        function openMenuForm(menuId = null) {
            editingMenuId = menuId;
            const formTitle = document.getElementById('menu-form-title');
            
            if (menuId) {
                const menu = menuItems.find(m => m.id === menuId);
                if (menu) {
                    formTitle.textContent = 'Edit Menu';
                    document.getElementById('input-menu-title').value = menu.title;
                    document.getElementById('input-menu-icon').value = menu.icon;
                    document.getElementById('input-menu-description').value = menu.description;
                }
            } else {
                formTitle.textContent = 'Tambah Menu Baru';
                document.getElementById('menu-form').reset();
            }
            
            document.getElementById('add-menu-modal').classList.remove('hidden');
        }

        function saveMenu() {
            const title = document.getElementById('input-menu-title').value.trim();
            const icon = document.getElementById('input-menu-icon').value.trim();
            const description = document.getElementById('input-menu-description').value.trim();

            if (!title || !icon || !description) {
                showToast('‚ùå Semua field harus diisi', 'error');
                return;
            }

            if (editingMenuId) {
                const index = menuItems.findIndex(m => m.id === editingMenuId);
                if (index !== -1) {
                    menuItems[index] = {
                        ...menuItems[index],
                        title,
                        icon,
                        description
                    };
                    showToast('‚úÖ Menu berhasil diperbarui', 'success');
                }
            } else {
                const newMenu = {
                    id: 'custom_' + Date.now(),
                    title,
                    icon,
                    description,
                    subMenus: []
                };
                menuItems.push(newMenu);
                showToast('‚úÖ Menu baru berhasil ditambahkan', 'success');
            }

            saveMenusToStorage();
            renderMenuCards();
            renderMenuList();
            document.getElementById('add-menu-modal').classList.add('hidden');
            document.getElementById('menu-form').reset();
        }

        function renderSubMenuList(menuId) {
            const menu = menuItems.find(m => m.id === menuId);
            if (!menu) return;

            const submenuList = document.getElementById('submenu-list');
            const subMenus = menu.subMenus || [];

            if (subMenus.length === 0) {
                submenuList.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada sub menu. Klik "Tambah Sub Menu" untuk menambahkan.</p>';
                return;
            }

            submenuList.innerHTML = subMenus.map((sub, index) => `
                <div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between hover:bg-gray-100 transition-colors">
                    <div>
                        <h4 class="font-semibold text-gray-900">${sub.title}</h4>
                        <p class="text-xs text-gray-500 mt-1">Sheet: ${sub.sheet}</p>
                        <p class="text-xs text-gray-400 mt-1">${sub.sheetUrl ? '‚úÖ URL tersimpan' : '‚ö†Ô∏è Belum ada URL'}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="btn-edit-submenu bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors" data-id="${sub.id}">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn-delete-submenu bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors" data-id="${sub.id}">
                            üóëÔ∏è Hapus
                        </button>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.btn-edit-submenu').forEach(btn => {
                btn.addEventListener('click', () => {
                    const subId = btn.dataset.id;
                    openSubMenuForm(subId);
                });
            });

            document.querySelectorAll('.btn-delete-submenu').forEach(btn => {
                btn.addEventListener('click', () => {
                    const subId = btn.dataset.id;
                    deleteSubMenu(subId);
                });
            });
        }

        function openSubMenuForm(subMenuId = null) {
            editingSubMenuId = subMenuId;
            const formTitle = document.getElementById('submenu-form-title');
            
            if (subMenuId) {
                const menu = menuItems.find(m => m.id === currentMenuId);
                const subMenu = menu.subMenus.find(s => s.id === subMenuId);
                if (subMenu) {
                    formTitle.textContent = 'Edit Sub Menu';
                    document.getElementById('input-submenu-title').value = subMenu.title;
                    document.getElementById('input-submenu-sheet').value = subMenu.sheet;
                    document.getElementById('input-submenu-url').value = subMenu.sheetUrl || '';
                }
            } else {
                formTitle.textContent = 'Tambah Sub Menu';
                document.getElementById('submenu-form').reset();
            }
            
            document.getElementById('add-submenu-modal').classList.remove('hidden');
        }

        function saveSubMenu() {
            const title = document.getElementById('input-submenu-title').value.trim();
            const sheet = document.getElementById('input-submenu-sheet').value.trim();
            const sheetUrl = document.getElementById('input-submenu-url').value.trim();

            if (!title || !sheet || !sheetUrl) {
                showToast('‚ùå Semua field harus diisi', 'error');
                return;
            }

            if (!extractSheetId(sheetUrl)) {
                showToast('‚ùå URL Google Sheets tidak valid', 'error');
                return;
            }

            const menuIndex = menuItems.findIndex(m => m.id === currentMenuId);
            if (menuIndex === -1) return;

            if (!menuItems[menuIndex].subMenus) {
                menuItems[menuIndex].subMenus = [];
            }

            if (editingSubMenuId) {
                const subIndex = menuItems[menuIndex].subMenus.findIndex(s => s.id === editingSubMenuId);
                if (subIndex !== -1) {
                    menuItems[menuIndex].subMenus[subIndex] = {
                        ...menuItems[menuIndex].subMenus[subIndex],
                        title,
                        sheet,
                        sheetUrl
                    };
                    showToast('‚úÖ Sub menu berhasil diperbarui', 'success');
                }
            } else {
                const newSubMenu = {
                    id: 'sub_' + Date.now(),
                    title,
                    sheet,
                    sheetUrl
                };
                menuItems[menuIndex].subMenus.push(newSubMenu);
                showToast('‚úÖ Sub menu baru berhasil ditambahkan', 'success');
            }

            saveMenusToStorage();
            renderSubMenuList(currentMenuId);
            showSubMenus(currentMenuId);
            document.getElementById('add-submenu-modal').classList.add('hidden');
            document.getElementById('submenu-form').reset();
        }

        function deleteSubMenu(subMenuId) {
            const submenuList = document.getElementById('submenu-list');
            const submenuElement = event.target.closest('.bg-gray-50');
            
            const originalHTML = submenuElement.innerHTML;
            
            submenuElement.innerHTML = `
                <div class="flex items-center justify-between">
                    <p class="text-gray-900 font-medium">Yakin ingin menghapus sub menu ini?</p>
                    <div class="flex space-x-2">
                        <button class="btn-confirm-delete-sub bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-medium transition-colors">
                            Ya, Hapus
                        </button>
                        <button class="btn-cancel-delete-sub bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded font-medium transition-colors">
                            Batal
                        </button>
                    </div>
                </div>
            `;

            submenuElement.querySelector('.btn-confirm-delete-sub').addEventListener('click', () => {
                const menuIndex = menuItems.findIndex(m => m.id === currentMenuId);
                if (menuIndex !== -1) {
                    const subIndex = menuItems[menuIndex].subMenus.findIndex(s => s.id === subMenuId);
                    if (subIndex !== -1) {
                        menuItems[menuIndex].subMenus.splice(subIndex, 1);
                        saveMenusToStorage();
                        renderSubMenuList(currentMenuId);
                        showSubMenus(currentMenuId);
                        showToast('‚úÖ Sub menu berhasil dihapus', 'success');
                    }
                }
            });

            submenuElement.querySelector('.btn-cancel-delete-sub').addEventListener('click', () => {
                submenuElement.innerHTML = originalHTML;
                renderSubMenuList(currentMenuId);
            });
        }

        function deleteMenu(menuId) {
            const menuList = document.getElementById('menu-list');
            const menuElement = event.target.closest('.bg-gray-50');
            
            const originalHTML = menuElement.innerHTML;
            
            menuElement.innerHTML = `
                <div class="flex items-center justify-between">
                    <p class="text-gray-900 font-medium">Yakin ingin menghapus menu ini?</p>
                    <div class="flex space-x-2">
                        <button class="btn-confirm-delete bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded font-medium transition-colors">
                            Ya, Hapus
                        </button>
                        <button class="btn-cancel-delete bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded font-medium transition-colors">
                            Batal
                        </button>
                    </div>
                </div>
            `;

            menuElement.querySelector('.btn-confirm-delete').addEventListener('click', () => {
                const index = menuItems.findIndex(m => m.id === menuId);
                if (index !== -1) {
                    menuItems.splice(index, 1);
                    saveMenusToStorage();
                    renderMenuCards();
                    renderMenuList();
                    showToast('‚úÖ Menu berhasil dihapus', 'success');
                }
            });

            menuElement.querySelector('.btn-cancel-delete').addEventListener('click', () => {
                menuElement.innerHTML = originalHTML;
                renderMenuList();
            });
        }

        async function loadSheetData(sheetName, sheetUrl, titleOverride = null) {
            if (!sheetUrl) {
                showToast('‚ö†Ô∏è URL Google Sheets belum dikonfigurasi untuk sub menu ini. Login sebagai admin untuk mengatur URL.', 'error');
                return;
            }

            const sheetId = extractSheetId(sheetUrl);
            if (!sheetId) {
                showToast('‚ùå URL Google Sheets tidak valid', 'error');
                return;
            }

            currentSheet = sheetName;
            currentSheetUrl = sheetUrl;
            currentPage = 1;
            
            document.getElementById('menu-section').classList.add('hidden');
            document.getElementById('submenu-section').classList.add('hidden');
            document.getElementById('data-section').classList.remove('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            document.getElementById('error-state').classList.add('hidden');
            document.getElementById('table-container').classList.add('hidden');
            
            document.getElementById('data-title').textContent = titleOverride || sheetName;

            try {
                const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                const jsonMatch = text.match(/google\.visualization\.Query\.setResponse\((.*)\);/);
                if (!jsonMatch) {
                    throw new Error('Invalid response format');
                }
                
                const data = JSON.parse(jsonMatch[1]);
                
                if (data.status === 'error') {
                    throw new Error(data.errors[0].detailed_message || data.errors[0].message);
                }
                
                const cols = data.table.cols.map(col => col.label || col.id);
                const rows = data.table.rows.map(row => {
                    const obj = {};
                    cols.forEach((col, index) => {
                        const cell = row.c[index];
                        obj[col] = cell ? (cell.f || cell.v) : '';
                    });
                    return obj;
                });
                
                currentData = rows;
                
                document.getElementById('loading-state').classList.add('hidden');
                
                if (currentData.length === 0) {
                    showError('Tidak ada data tersedia di sheet ini');
                } else {
                    document.getElementById('table-container').classList.remove('hidden');
                    renderTable();
                }
            } catch (error) {
                document.getElementById('loading-state').classList.add('hidden');
                showError(error.message + '. Pastikan sheet sudah dibagikan sebagai "Anyone with the link can view" dan nama sheet sama persis dengan yang ada di Sub Menu');
            }
        }

        function renderTable() {
            if (currentData.length === 0) return;

            const headers = Object.keys(currentData[0]);
            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');

            tableHeader.innerHTML = headers.map(header => `
                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    ${header.replace(/_/g, ' ')}
                </th>
            `).join('');

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = currentData.slice(startIndex, endIndex);

            tableBody.innerHTML = paginatedData.map((row, index) => `
                <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-blue-50 transition-colors">
                    ${headers.map(header => `
                        <td class="px-3 sm:px-6 py-3 sm:py-4 text-xs sm:text-sm text-gray-900">
                            ${row[header] || '-'}
                        </td>
                    `).join('')}
                </tr>
            `).join('');

            const totalPages = Math.ceil(currentData.length / itemsPerPage);
            document.getElementById('pagination-info').textContent = 
                `Menampilkan ${startIndex + 1}-${Math.min(endIndex, currentData.length)} dari ${currentData.length} data`;
            
            document.getElementById('btn-prev').disabled = currentPage === 1;
            document.getElementById('btn-next').disabled = currentPage === totalPages;
        }

        function showError(message) {
            document.getElementById('error-state').classList.remove('hidden');
            document.getElementById('error-message').textContent = message;
        }

        let currentMenuId = null;

        function showSubMenus(menuId) {
            currentMenuId = menuId;
            const menu = menuItems.find(m => m.id === menuId);
            if (!menu) return;

            document.getElementById('menu-section').classList.add('hidden');
            document.getElementById('data-section').classList.add('hidden');
            document.getElementById('submenu-section').classList.remove('hidden');
            
            document.getElementById('submenu-title').textContent = menu.title;
            document.getElementById('submenu-icon').textContent = menu.icon;
            
            const manageSubMenuBtn = document.getElementById('btn-manage-submenu');
            if (currentUser && currentUser.role === 'admin') {
                manageSubMenuBtn.classList.remove('hidden');
            } else {
                manageSubMenuBtn.classList.add('hidden');
            }
            
            const submenuGrid = document.getElementById('submenu-grid');
            submenuGrid.innerHTML = (menu.subMenus || []).map(sub => `
                <div class="submenu-card bg-white rounded-lg shadow-md p-5 cursor-pointer hover:shadow-lg transition-all ${!sub.sheetUrl ? 'opacity-50' : ''}" data-sheet="${sub.sheet}" data-url="${sub.sheetUrl || ''}">
                    <h4 class="text-lg font-semibold text-gray-900 mb-1">${sub.title}</h4>
                    <p class="text-xs text-gray-500">Sheet: ${sub.sheet}</p>
                    ${!sub.sheetUrl ? '<p class="text-xs text-red-500 mt-1">‚ö†Ô∏è URL belum dikonfigurasi</p>' : '<p class="text-xs text-green-600 mt-1">‚úÖ Siap digunakan</p>'}
                </div>
            `).join('');

            document.querySelectorAll('.submenu-card').forEach(card => {
                card.addEventListener('click', () => {
                    const sheet = card.dataset.sheet;
                    const url = card.dataset.url;
                    const submenu = menu.subMenus.find(s => s.sheet === sheet);
                    
                    if (url) {
                        loadSheetData(sheet, url, submenu ? submenu.title : sheet);
                    } else {
                        showToast('‚ö†Ô∏è URL Google Sheets belum dikonfigurasi untuk sub menu ini', 'error');
                    }
                });
            });
        }

        function showMenuSection() {
            document.getElementById('menu-section').classList.remove('hidden');
            document.getElementById('data-section').classList.add('hidden');
            document.getElementById('submenu-section').classList.add('hidden');
            currentSheet = null;
            currentSheetUrl = null;
            currentData = [];
            currentMenuId = null;
        }

        function backToSubMenus() {
            document.getElementById('data-section').classList.add('hidden');
            document.getElementById('submenu-section').classList.remove('hidden');
            currentSheet = null;
            currentSheetUrl = null;
            currentData = [];
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        init();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b5321b2f661273f',t:'MTc2Njk0NjY1NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>